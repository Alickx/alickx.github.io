<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>掘金小册-Java 并发编程-读后总结（一） | 李同学的网络日志</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="https://img.llwstu.com/img/202208212351351.ico">
    <script language="javascript" type="text/javascript" src="/js/pgmanor-self.js"></script>
    <meta name="description" content="李同学的网络日志">
    <meta name="keywords" content="李同学的网络日志,李同学,李卤味同学,李卤味同学仔">
    <meta name="theme-color" content="#11a8cd">
    <meta name="referrer" content="no-referrer-when-downgrade">
    
    <link rel="preload" href="/assets/css/0.styles.54cc745d.css" as="style"><link rel="preload" href="/assets/js/app.f2be4141.js" as="script"><link rel="preload" href="/assets/js/4.aa149d1c.js" as="script"><link rel="preload" href="/assets/js/9.aaa0b737.js" as="script"><link rel="prefetch" href="/assets/js/10.73da5800.js"><link rel="prefetch" href="/assets/js/11.58f3045c.js"><link rel="prefetch" href="/assets/js/12.48e6d322.js"><link rel="prefetch" href="/assets/js/13.e48cfae2.js"><link rel="prefetch" href="/assets/js/14.6e2ee11e.js"><link rel="prefetch" href="/assets/js/15.b6149c92.js"><link rel="prefetch" href="/assets/js/16.673b7139.js"><link rel="prefetch" href="/assets/js/17.e4a79509.js"><link rel="prefetch" href="/assets/js/5.0fa0a922.js"><link rel="prefetch" href="/assets/js/6.bb65bfea.js"><link rel="prefetch" href="/assets/js/7.2b0165f8.js"><link rel="prefetch" href="/assets/js/8.9d16b7e1.js"><link rel="prefetch" href="/assets/js/vendors~flowchart.f666169a.js"><link rel="prefetch" href="/assets/js/vendors~mermaid.a5329e91.js">
    <link rel="stylesheet" href="/assets/css/0.styles.54cc745d.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu only-sidebarItem"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="https://img.llwstu.com/img/202208212350813.png" alt="李同学的网络日志" class="logo"> <span class="site-name can-hide">李同学的网络日志</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/archives/" class="nav-link">文章归档</a></div><div class="nav-item"><a href="/message-board/" class="nav-link">留言板</a></div> <a href="https://github.com/Alickx/alickx.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/archives/" class="nav-link">文章归档</a></div><div class="nav-item"><a href="/message-board/" class="nav-link">留言板</a></div> <a href="https://github.com/Alickx/alickx.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/pages/1b95c2/" aria-current="page" class="active sidebar-link">掘金小册-Java 并发编程-读后总结（一）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/1b95c2/#_1-回顾" class="sidebar-link">1. 回顾</a></li><li class="sidebar-sub-header level2"><a href="/pages/1b95c2/#_2-学习" class="sidebar-link">2. 学习</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/1b95c2/#_1-经典的i-问题" class="sidebar-link">1. 经典的i++问题</a></li><li class="sidebar-sub-header level3"><a href="/pages/1b95c2/#_2-程序与cpu的协作关系" class="sidebar-link">2. 程序与cpu的协作关系</a></li><li class="sidebar-sub-header level3"><a href="/pages/1b95c2/#_3-cpu的几大模块" class="sidebar-link">3. Cpu的几大模块</a></li><li class="sidebar-sub-header level3"><a href="/pages/1b95c2/#_4-寄存器和程序之间的关系" class="sidebar-link">4. 寄存器和程序之间的关系</a></li><li class="sidebar-sub-header level3"><a href="/pages/1b95c2/#_5-临界区" class="sidebar-link">5. 临界区</a></li><li class="sidebar-sub-header level3"><a href="/pages/1b95c2/#_6-信号量" class="sidebar-link">6. 信号量</a></li><li class="sidebar-sub-header level3"><a href="/pages/1b95c2/#_7-管程和其三大模型" class="sidebar-link">7.管程和其三大模型</a></li></ul></li></ul></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><span data-v-06225672>Java并发编程</span></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/Alickx" target="_blank" title="作者" class="beLink" data-v-06225672>李同学 | Alickx</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2022-08-27</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">掘金小册-Java 并发编程-读后总结（一）<!----></h1> <!----> <div class="theme-vdoing-content content__default"><p>阅读掘金小册 Java 并发编程后的读后总结。</p> <h2 id="_1-回顾"><a href="#_1-回顾" class="header-anchor">#</a> 1. 回顾</h2> <ol><li>经典的i++问题</li> <li>程序和Cpu之间的协作关系</li> <li>Cpu的几大模块</li> <li>寄存器和程序之间的关系</li> <li>临界区</li> <li>信号量</li> <li>管程和其三大模型</li></ol> <h2 id="_2-学习"><a href="#_2-学习" class="header-anchor">#</a> 2. 学习</h2> <h3 id="_1-经典的i-问题"><a href="#_1-经典的i-问题" class="header-anchor">#</a> 1. 经典的i++问题</h3> <p>在开章作者给出了一段代码，通过CountDownLatch模拟并发线程执行加操作。下面贴上这段代码。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadDemo</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>


    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">IncrTask</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>
        <span class="token class-name">CountDownLatch</span> start<span class="token punctuation">;</span>
        <span class="token class-name">CountDownLatch</span> end<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token class-name">IncrTask</span><span class="token punctuation">(</span><span class="token class-name">CountDownLatch</span> start<span class="token punctuation">,</span> <span class="token class-name">CountDownLatch</span> end<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>start <span class="token operator">=</span> start<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>end <span class="token operator">=</span> end<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                start<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    j<span class="token operator">++</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                end<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">CountDownLatch</span> start <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CountDownLatch</span> end <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">IncrTask</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            t<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        start<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        end<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;result is :&quot;</span> <span class="token operator">+</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><p>在Idea上执行一下这段代码试试看。有概率获得数值会低于10000。</p> <p><img src="https://img.llwstu.com/img/202208271437497.png" alt="image-20220827143709293"></p> <p>这里之所以低于10000是因为这里i++操作包含了三个操作，一个是读取数值，第二个是进行增加，第三个是将增加后的数值设置回原先的内存地址当中。其中有可能在你读取数值后，其他线程对这个变量进行的增加并比第一个线程<strong>先一步设置回原先的内存地址当中</strong>。这就会导致，你设置的值是旧值，所以会发生最终结果会少于10000的情况出现。</p> <h3 id="_2-程序与cpu的协作关系"><a href="#_2-程序与cpu的协作关系" class="header-anchor">#</a> 2. 程序与cpu的协作关系</h3> <p>Cpu中存在寄存器，控制器，运算器和时钟。其中寄存器是我们最需要关心的地方，因为其主要存储了从内存中加载的数据。寄存器的读写速度比内存高了不知道多少个级别，所以需要L1,L2,L3缓存来存储这些数据。</p> <p>其实我们在业务中运用到的二级缓存，三级缓存的思想也是参考计算机硬件设计思想的。</p> <p><img src="https://img.llwstu.com/img/202208271448204.webp" alt="image.png"></p> <h3 id="_3-cpu的几大模块"><a href="#_3-cpu的几大模块" class="header-anchor">#</a> 3. Cpu的几大模块</h3> <p>上面就列出了，Cpu主要的模块有寄存器，控制器，时钟，运算器。其中寄存器又分为两大类，分别是<code>存储内存地址类寄存器</code>和<code>存储非内存地址寄存器</code>。这两大类下面又有这些小类。</p> <p><img src="https://img.llwstu.com/img/202208271451193.webp" alt="img"></p> <h3 id="_4-寄存器和程序之间的关系"><a href="#_4-寄存器和程序之间的关系" class="header-anchor">#</a> 4. 寄存器和程序之间的关系</h3> <p>举刚才的i++的例子，我们<code>编写好代码</code>，代码首先会持久化到<code>硬盘</code>上，然后运行的时候，我们会编译这段代码，从硬盘中读取该代码的<code>后缀为java</code>的文件，这个文件就是纯天然无污染的我们写的代码文件，然后通过<code>javac</code>命令编译生成class文件，即<code>字节码</code>文件，然后通过JIT编译再将字节码文件编译成<code>机器码</code>。</p> <p>上面所使用到的javac指令还有JIT编译器其实都是属于Java编译器的一个大类。 先将java代码编译成字节码，再将字节码编译成机器码。 Java也属于<strong>半编译半解释</strong>的语言。</p> <p><img src="https://img.llwstu.com/img/202208271504427.webp" alt="image.png"></p> <p>机器码存放的<strong>地址</strong>会被放到一种叫做<strong>程序计数器</strong>的寄存器中，之后<strong>控制器</strong>会到根据程序计数器的地址去读取相关的机器指令，并且将指令读取给<strong>运算器</strong>进行计算。当运行结束之后，<strong>程序计数器的地址就会刷新，让控制器去加载新内存地址的指令给到运算器。</strong></p> <p>最后面的刷新和加载新地址，其实也就对应了我们i++操作中，读取地址，进行修改，设置回去。</p> <h3 id="_5-临界区"><a href="#_5-临界区" class="header-anchor">#</a> 5. 临界区</h3> <p>在操作系统的课程上，我了解到临界区这一个名词。当时背到的解释是访问临界资源的代码就叫临界区。那这个临界资源其实就是指共享资源，当某一时刻同时有多个进程或者线程访问某一临界区的时候，就可能会出现数据安全问题。</p> <h3 id="_6-信号量"><a href="#_6-信号量" class="header-anchor">#</a> 6. 信号量</h3> <p>在操作系统课程上，我也学习到信号量这一个名词，信号量是线程或进程间通信的一种方式。文章中也说到是一种设计思想，本质可以理解为一个整形的数字，对于这个数字的操作，就有熟悉的PV操作。</p> <p>sem 即 信号量</p> <p>P(): sem - 1，如果sem为0则进入等待状态</p> <p>v(): sem + 1，如果sem为0则同时会唤醒一个等待的P</p> <p>信号量的操作是具有<code>原子性</code>的，原子性指的就是全部操作要不全部成功，要不全部失败，不会出现一些成功，一些失败。这里的实现是依赖于操作系统的底层，即<code>原语</code>。</p> <p><img src="https://img.llwstu.com/img/202208271515427.webp" alt="image.png"></p> <h3 id="_7-管程和其三大模型"><a href="#_7-管程和其三大模型" class="header-anchor">#</a> 7.管程和其三大模型</h3> <blockquote><p><code>管程</code> 可以理解为是基于信号量的基础上做了一层封装，专门用于访问一些共享变量的函数，让其调用方使用起来更加简单和清晰，它的作用是<strong>一次只允许有一个线程访问临界期，如果同时有太多个访问，则将多余的访问挂起</strong>。</p> <p><strong>这里需要注意的是，信号量的应用主要是基于操作系统层面中，而管程的提出</strong> <strong>，</strong> <strong>则是用在了语言的场景中，它主要是专门针对语言中的并发场景而设计的，从而简化了一些语言层面的实现逻辑。</strong></p> <p>例如Java内部对于并发模块的实现 wait()、notify()、notifyAll() 这些函数就是采用了管程技术来控制的。</p></blockquote> <p>说白了，其实就是在我们使用的高级语言的层面对底层PV操作进行了封装，让我们可以通过简单的函数就可以操作。这就叫管程。</p> <p>那还有一个叫<code>协程</code>的东西呢？ 协程是一个在线程之上，在进程之下的一个东西。当我们有多个请求的时候，我们需要起对应请求数量的线程来处理，线程之间的切换同时也要经过用户态和内核态。可是协程可以通过复用的方式，不需要多个线程，只需要一个线程就可以执行。</p> <p>下面是廖雪峰官网的解释: <a href="https://www.liaoxuefeng.com/wiki/1016959663602400/1017968846697824" target="_blank" rel="noopener noreferrer">廖雪峰的官方网站 - 协程<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <blockquote><p>最大的优势就是协程极高的执行效率。因为子程序切换不是线程切换，而是由程序自身控制，因此，没有线程切换的开销，和多线程比，线程数量越多，协程的性能优势就越明显。</p> <p>第二大优势就是不需要多线程的锁机制，因为只有一个线程，也不存在同时写变量冲突，在协程中控制共享资源不加锁，只需要判断状态就好了，所以执行效率比多线程高很多。</p> <p>因为协程是一个线程执行，那怎么利用多核CPU呢？最简单的方法是多进程+协程，既充分利用多核，又充分发挥协程的高效率，可获得极高的性能。</p></blockquote> <p>管程的组成：</p> <ul><li>一把锁</li> <li>0或者多个条件变量</li></ul> <p><strong>一把锁：</strong> 管程为了保证对于共享资源的访问一次只能有一个元素，所以才引入了锁的机制，没有抢到锁的请求则需要进入到<strong>锁的等待队列，主要是为了确保互斥性。</strong></p> <p><strong>0或者多个条件变量：</strong> 当获取到了锁的请求进入到了临界区模块中之后，有可能还需要做多个条件的判断，如果没有满足其中的某一条条件则需要进入到<strong>条件的等待队列</strong>中。</p> <p><img src="https://img.llwstu.com/img/202208271526213.webp" alt="img"></p> <p>当 Condition 调用了 signal() 函数的时候，会唤醒等待队列中的一个挂起线程，那么就会产生同时有两个线程访问到了临界区的共享资源，一个是当前触发 signal 函数的线程，一个是刚从挂起状态被唤醒的线程，这种情况下该如何处理呢？</p> <p>业界提出了三种管程的模型，三大模型则分别是<code>Hansen</code>,<code>Hoare</code>,<code>Mesa</code>模型。模拟一个场景，被挂起的线程为A，调用signal的线程为B</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Lock</span><span class="token operator">::</span><span class="token class-name">Acquire</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//等待锁可用，然后抢占</span>
<span class="token class-name">Lock</span><span class="token operator">::</span><span class="token class-name">Release</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//释放锁，唤醒等待队列中的线程</span>
<span class="token class-name">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//释放当前锁，进入睡眠状态，</span>
<span class="token class-name">Signal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//当某个条件满足的时候，就会唤醒等待队列中线程</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>抢到锁的线程想要主动释放锁，那么就需要主动地调用wait()方法。</p> <img src="https://img.llwstu.com/img/202208271535519.webp" alt="image.png" style="zoom:67%;"> <ol><li>Hansen ： 让A立即执行，B则处于睡眠状态，在等待A放行之后才继续让B执行。</li> <li>Horare ： 等待B完全执行完毕后，才允许让被唤醒的A继续执行。</li> <li>Mesa : B在执行Signal后不需要担心A的任何事情，B可以继续正常执行，A则会被重新放入到等待队列去参与抢占的行为。</li></ol></div></div> <!----> <div class="page-edit"><div class="edit-link"><a href="https://github.com/Alickx/alickx.github.io/edit/main/docs/Java并发编程/01.掘金小册-Java 并发编程-读后总结（一）.md" target="_blank" rel="noopener noreferrer">帮助我们改善此页面</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">10/21/2022, 2:09:27 PM</span></div></div> <div class="page-nav-wapper"><!----> <!----></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="https://github.com/Alickx" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="mailto:alickx@foxmail.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2022-2022
    <span>李同学的网络日志 | <a href="https://beian.miit.gov.cn/" target="_blank">粤ICP备2021005958号</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.f2be4141.js" defer></script><script src="/assets/js/4.aa149d1c.js" defer></script><script src="/assets/js/9.aaa0b737.js" defer></script>
  </body>
</html>
